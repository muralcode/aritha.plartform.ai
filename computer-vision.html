<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust/C++ Computer Vision Suite - Lerato Mokoena</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: #0a0a0a;
            position: relative;
            background: radial-gradient(circle at 50% 50%, rgba(88, 28, 135, 0.2) 0%, rgba(49, 46, 89, 0.1) 30%, #0a0a0a 70%);
        }
        .glass-card {
            background: rgba(20, 20, 20, 0.25);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.7), inset 0 0 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.5), 0 0 25px rgba(138, 43, 226, 0.9), inset 0 0 12px rgba(0, 0, 0, 0.4);
        }
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        nav {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
        }
        .hero-container {
            position: relative;
            isolation: isolate;
        }
        .logo-background {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.1;
            z-index: -1;
            width: 60%;
            max-width: 600px;
        }
        .shadow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.6) 70%, rgba(0, 0, 0, 0.9) 100%);
            z-index: -2;
        }
        .cv-card {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            border: 1px solid rgba(138, 43, 226, 0.5);
            box-shadow: 0 0 25px rgba(138, 43, 226, 0.8), inset 0 0 15px rgba(0, 0, 0, 0.4);
        }
        .cv-card:hover {
            box-shadow: 0 0 35px rgba(138, 43, 226, 1), inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .floating {
            animation: floating 6s ease-in-out infinite;
        }
        @keyframes floating {
            0% { transform: translate(0, 0px); }
            50% { transform: translate(0, 15px); }
            100% { transform: translate(0, -0px); }
        }
        .tech-icon {
            transition: all 0.3s ease;
        }
        .tech-icon:hover {
            transform: translateY(-5px) scale(1.1);
            filter: drop-shadow(0 0 8px rgba(138, 43, 226, 0.7));
        }
        .gradient-text {
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .fallback-logo {
            width: 100%;
            height: auto;
            opacity: 0.1;
        }
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(138, 43, 226, 0.8);
            color: white;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }
        .back-to-top:hover {
            background: rgba(138, 43, 226, 1);
            transform: translateY(-5px);
        }
        
        /* Computer Vision Specific Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 2rem 0;
        }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        .upload-section, .controls-section {
            background: rgba(52, 152, 219, 0.1);
            padding: 1.5rem;
            border-radius: 10px;
        }
        .controls-section {
            background: rgba(231, 76, 60, 0.1);
        }
        .results-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .results-section {
                grid-template-columns: 1fr;
            }
        }
        .image-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .image-container h3 {
            background: rgba(44, 62, 80, 0.9);
            padding: 0.8rem;
            text-align: center;
            margin: 0;
        }
        .image-box {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .image-box canvas {
            max-width: 100%;
            max-height: 100%;
            border: 2px solid #3498db;
            border-radius: 5px;
        }
        .stats {
            background: rgba(0, 0, 0, 0.4);
            padding: 1rem;
            font-family: monospace;
            border-top: 1px solid #3498db;
        }
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0.5rem;
        }
        .button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .button-danger {
            background: #e74c3c;
        }
        .button-danger:hover {
            background: #c0392b;
        }
        .button-success {
            background: #2ecc71;
        }
        .button-success:hover {
            background: #27ae60;
        }
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 1rem;
        }
        .filter-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #3498db;
            color: #ecf0f1;
            padding: 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-button:hover {
            background: #3498db;
        }
        .filter-button.active {
            background: #3498db;
            font-weight: bold;
            box-shadow: 0 0 10px #3498db;
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .slider-container {
            margin: 15px 0;
        }
        .slider-value {
            display: inline-block;
            width: 40px;
            text-align: right;
        }
        .explanation {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        .performance {
            color: #2ecc71;
            font-weight: bold;
        }
        .tech-badge {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 0.3rem;
        }
        .back-link {
            color: #3498db;
            text-decoration: none;
            display: flex;
            align-items: center;
            margin-top: 1rem;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="text-white scroll-smooth">
    <div class="shadow-layer"></div>
    
    <!-- Navigation -->
    <nav class="fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold text-indigo-400 hover:text-indigo-300">Lerato Mokoena</a>
                <div class="space-x-4">
                    <a href="index.html#about" class="text-gray-300 hover:text-indigo-400">About</a>
                    <a href="index.html#skills" class="text-gray-300 hover:text-indigo-400">Skills</a>
                    <a href="index.html#projects" class="text-gray-300 hover:text-indigo-400">Projects</a>
                    <a href="ml-glossary.html" class="text-gray-300 hover:text-indigo-400">ML Glossary</a>
                    <a href="index.html#contact" class="text-gray-300 hover:text-indigo-400">Contact</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="min-h-screen flex items-center justify-center pt-16">
        <div class="hero-container">
            <!-- Fallback SVG logo in case the PNG doesn't load -->
            <div class="logo-background" id="logoContainer">
                <svg class="fallback-logo floating" viewBox="0 0 500 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#8B5CF6" />
                            <stop offset="100%" stop-color="#EC4899" />
                        </linearGradient>
                    </defs>
                    <path d="M50,100 Q150,50 250,100 T450,100" stroke="url(#gradient)" stroke-width="10" fill="none" />
                    <text x="250" y="120" text-anchor="middle" fill="url(#gradient)" font-size="32" font-weight="bold">ARITHA AI</text>
                    <text x="250" y="160" text-anchor="middle" fill="rgba(139,92,246,0.7)" font-size="18">Computer Vision Suite</text>
                </svg>
            </div>
            <div class="text-center max-w-4xl mx-auto px-4 glass-card p-8 rounded-lg">
                <h1 class="text-4xl sm:text-5xl font-bold mb-4 gradient-text">Rust/C++ Computer Vision Suite</h1>
                <p class="text-xl sm:text-2xl mb-6">WebAssembly-powered image processing demonstrating low-level programming skills</p>
                <div class="flex justify-center flex-wrap mb-6">
                    <span class="tech-badge bg-indigo-500">Rust</span>
                    <span class="tech-badge bg-purple-500">C++</span>
                    <span class="tech-badge bg-blue-500">WebAssembly</span>
                    <span class="tech-badge bg-pink-500">Computer Vision</span>
                    <span class="tech-badge bg-green-500">GitHub Pages</span>
                </div>
                <a href="#demo" class="bg-indigo-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-indigo-600 transition inline-block pulse">
                    <i class="fas fa-camera mr-2"></i>Try the Demo
                </a>
            </div>
        </div>
    </section>

    <!-- Demo Section -->
    <section id="demo" class="py-20">
        <div class="container">
            <h2 class="text-3xl font-bold text-indigo-300 mb-8 text-center">WebAssembly Image Processing Demo</h2>
            
            <div class="main-content">
                <div class="glass-card p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-indigo-300 mb-4">Upload an Image</h3>
                    <p class="mb-4">Select an image to process with WebAssembly filters</p>
                    <input type="file" id="imageUpload" accept="image/*" class="hidden">
                    <button class="button w-full" id="uploadButton">
                        <i class="fas fa-upload mr-2"></i>Choose Image
                    </button>
                    <div class="sample-images mt-4">
                        <p class="mb-2">Or use a sample image:</p>
                        <button class="button button-success" id="sample1">
                            <i class="fas fa-image mr-2"></i>Sample 1
                        </button>
                        <button class="button button-success" id="sample2">
                            <i class="fas fa-image mr-2"></i>Sample 2
                        </button>
                    </div>
                </div>
                
                <div class="glass-card p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold text-indigo-300 mb-4">Filters & Controls</h3>
                    <p>Select a filter to apply to your image</p>
                    
                    <div class="filter-grid">
                        <button class="filter-button active" data-filter="grayscale">
                            <i class="fas fa-moon mr-1"></i> Grayscale
                        </button>
                        <button class="filter-button" data-filter="blur">
                            <i class="fas fa-cloud mr-1"></i> Blur
                        </button>
                        <button class="filter-button" data-filter="edges">
                            <i class="fas fa-drafting-compass mr-1"></i> Edges
                        </button>
                        <button class="filter-button" data-filter="sharpen">
                            <i class="fas fa-cut mr-1"></i> Sharpen
                        </button>
                        <button class="filter-button" data-filter="invert">
                            <i class="fas fa-adjust mr-1"></i> Invert
                        </button>
                        <button class="filter-button" data-filter="emboss">
                            <i class="fas fa-mountain mr-1"></i> Emboss
                        </button>
                    </div>
                    
                    <div class="slider-container">
                        <label for="intensity" class="block mb-2">Filter Intensity: <span class="slider-value" id="intensityValue">5</span></label>
                        <input type="range" id="intensity" min="1" max="10" value="5" class="w-full">
                    </div>
                    
                    <div class="flex space-x-2 mt-4">
                        <button class="button button-success flex-1" id="processButton">
                            <i class="fas fa-play-circle mr-2"></i>Apply Filter
                        </button>
                        <button class="button button-danger flex-1" id="resetButton">
                            <i class="fas fa-redo mr-2"></i>Reset Image
                        </button>
                    </div>
                    
                    <div class="performance-section mt-4">
                        <p class="performance">Processing time: <span id="processingTime">0</span> ms</p>
                    </div>
                </div>
                
                <div class="results-section">
                    <div class="glass-card overflow-hidden">
                        <h3 class="text-xl font-semibold text-indigo-300 p-4 bg-indigo-900/50">Original Image</h3>
                        <div class="image-box">
                            <canvas id="originalCanvas"></canvas>
                        </div>
                        <div class="stats" id="originalStats">
                            Dimensions: 0 x 0 | Size: 0 KB
                        </div>
                    </div>
                    
                    <div class="glass-card overflow-hidden">
                        <h3 class="text-xl font-semibold text-indigo-300 p-4 bg-indigo-900/50">Processed Image</h3>
                        <div class="image-box">
                            <canvas id="processedCanvas"></canvas>
                        </div>
                        <div class="stats" id="processedStats">
                            Dimensions: 0 x 0 | Filter: None
                        </div>
                    </div>
                </div>
                
                <div class="explanation glass-card">
                    <h3 class="text-2xl font-semibold text-indigo-300 mb-4">How This Demonstrates Rust & C++ Skills</h3>
                    <p>This application showcases advanced programming skills by:</p>
                    <ul class="list-disc list-inside mt-2 ml-4 space-y-2">
                        <li>Implementing performance-critical algorithms in Rust/C++</li>
                        <li>Compiling to WebAssembly for near-native performance in browsers</li>
                        <li>Handling memory management manually for optimal performance</li>
                        <li>Implementing complex mathematical operations (convolution matrices for filters)</li>
                        <li>Demonstrating cross-language integration (Rust/C++ → WebAssembly → JavaScript)</li>
                        <li>Showcasing ability to work with low-level data structures (direct pixel manipulation)</li>
                    </ul>
                    <p class="mt-4">These skills are directly applicable to high-performance applications in fields like computer vision, game development, scientific computing, and more.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Footer -->
    <footer class="bg-black/80 text-white py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>Created with Rust, C++, and WebAssembly | Hosted on GitHub Pages</p>
            <p class="mt-2">© 2023 | Designed to Showcase Low-Level Programming Skills</p>
            <div class="mt-4">
                <a href="index.html" class="text-indigo-400 hover:text-indigo-300 mx-2">Back to Portfolio</a>
                <a href="ml-glossary.html" class="text-indigo-400 hover:text-indigo-300 mx-2">ML Glossary</a>
            </div>
        </div>
    </footer>

    <script>
        // DOM elements
        const uploadButton = document.getElementById('uploadButton');
        const imageUpload = document.getElementById('imageUpload');
        const originalCanvas = document.getElementById('originalCanvas');
        const processedCanvas = document.getElementById('processedCanvas');
        const processButton = document.getElementById('processButton');
        const resetButton = document.getElementById('resetButton');
        const originalStats = document.getElementById('originalStats');
        const processedStats = document.getElementById('processedStats');
        const processingTime = document.getElementById('processingTime');
        const intensitySlider = document.getElementById('intensity');
        const intensityValue = document.getElementById('intensityValue');
        const filterButtons = document.querySelectorAll('.filter-button');
        const sample1Button = document.getElementById('sample1');
        const sample2Button = document.getElementById('sample2');
        
        // Canvas context
        const originalCtx = originalCanvas.getContext('2d');
        const processedCtx = processedCanvas.getContext('2d');
        
        // State variables
        let originalImageData = null;
        let currentFilter = 'grayscale';
        
        // Event listeners
        uploadButton.addEventListener('click', () => imageUpload.click());
        imageUpload.addEventListener('change', handleImageUpload);
        processButton.addEventListener('click', processImage);
        resetButton.addEventListener('click', resetImage);
        intensitySlider.addEventListener('input', updateIntensityValue);
        sample1Button.addEventListener('click', () => loadSampleImage(1));
        sample2Button.addEventListener('click', () => loadSampleImage(2));
        
        // Filter selection
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                currentFilter = button.dataset.filter;
            });
        });
        
        // Initialize intensity value
        updateIntensityValue();
        
        // Back to top button
        const backToTopButton = document.getElementById('backToTop');
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.style.display = 'flex';
            } else {
                backToTopButton.style.display = 'none';
            }
        });
        
        // Try to load the logo image, fallback to SVG if it fails
        document.addEventListener('DOMContentLoaded', function() {
            const logoContainer = document.getElementById('logoContainer');
            const logoImg = new Image();
            
            logoImg.onload = function() {
                // If the image loads successfully, replace the SVG with the image
                logoContainer.innerHTML = '';
                const imgElement = document.createElement('img');
                imgElement.src = 'assets/arithaai.png';
                imgElement.alt = 'Aritha AI Logo';
                imgElement.className = 'logo-background floating';
                logoContainer.appendChild(imgElement);
            };
            
            logoImg.onerror = function() {
                // If the image fails to load, keep the SVG fallback
                console.log('Logo image not found, using SVG fallback');
            };
            
            // Try to load the image
            logoImg.src = 'assets/arithaai.png';
            
            // Load a default sample image on page load
            loadSampleImage(1);
        });

        // Functions
        function updateIntensityValue() {
            intensityValue.textContent = intensitySlider.value;
        }
        
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    drawImageToCanvas(img, originalCanvas, originalCtx);
                    originalImageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);
                    updateImageStats(originalStats, originalCanvas, 'Original');
                    resetProcessedCanvas();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function loadSampleImage(number) {
            const img = new Image();
            img.onload = function() {
                drawImageToCanvas(img, originalCanvas, originalCtx);
                originalImageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);
                updateImageStats(originalStats, originalCanvas, 'Original');
                resetProcessedCanvas();
            };
            // Using placeholder images from picsum.photos
            img.src = `https://picsum.photos/600/400?random=${number}`;
        }
        
        function drawImageToCanvas(img, canvas, ctx) {
            // Calculate dimensions to fit in canvas while maintaining aspect ratio
            const maxWidth = 600;
            const maxHeight = 400;
            
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
                height = (maxWidth / width) * height;
                width = maxWidth;
            }
            
            if (height > maxHeight) {
                width = (maxHeight / height) * width;
                height = maxHeight;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0, width, height);
        }
        
        function resetProcessedCanvas() {
            processedCanvas.width = originalCanvas.width;
            processedCanvas.height = originalCanvas.height;
            processedCtx.clearRect(0, 0, processedCanvas.width, processedCanvas.height);
            processedStats.textContent = `Dimensions: 0 x 0 | Filter: None`;
        }
        
        function updateImageStats(statsElement, canvas, type) {
            const sizeKB = (canvas.width * canvas.height * 4) / 1024;
            statsElement.textContent = `Dimensions: ${canvas.width} x ${canvas.height} | Size: ${sizeKB.toFixed(2)} KB`;
        }
        
        function resetImage() {
            if (originalImageData) {
                originalCtx.putImageData(originalImageData, 0, 0);
                resetProcessedCanvas();
            }
        }
        
        function processImage() {
            if (!originalImageData) return;
            
            // Simulate WebAssembly processing with a JavaScript implementation
            // In a real scenario, this would call WebAssembly functions compiled from Rust/C++
            const startTime = performance.now();
            
            // Copy original image data
            const width = originalCanvas.width;
            const height = originalCanvas.height;
            const processedData = new ImageData(width, height);
            
            // Get intensity value
            const intensity = parseInt(intensitySlider.value);
            
            // Apply selected filter
            switch(currentFilter) {
                case 'grayscale':
                    applyGrayscale(originalImageData, processedData);
                    break;
                case 'blur':
                    applyBlur(originalImageData, processedData, intensity);
                    break;
                case 'edges':
                    applyEdgeDetection(originalImageData, processedData, intensity);
                    break;
                case 'sharpen':
                    applySharpen(originalImageData, processedData, intensity);
                    break;
                case 'invert':
                    applyInvert(originalImageData, processedData);
                    break;
                case 'emboss':
                    applyEmboss(originalImageData, processedData, intensity);
                    break;
            }
            
            // Display processing time
            const endTime = performance.now();
            processingTime.textContent = (endTime - startTime).toFixed(2);
            
            // Draw processed image
            processedCanvas.width = width;
            processedCanvas.height = height;
            processedCtx.putImageData(processedData, 0, 0);
            
            // Update stats
            processedStats.textContent = `Dimensions: ${width} x ${height} | Filter: ${currentFilter}`;
        }
        
        // Filter implementations (simulating what would be done in WebAssembly)
        function applyGrayscale(input, output) {
            const data = input.data;
            const outputData = output.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const avg = data[i] * 0.3 + data[i + 1] * 0.59 + data[i + 2] * 0.11;
                outputData[i] = avg;
                outputData[i + 1] = avg;
                outputData[i + 2] = avg;
                outputData[i + 3] = data[i + 3];
            }
        }
        
        function applyBlur(input, output, intensity) {
            const data = input.data;
            const outputData = output.data;
            const width = input.width;
            const height = input.height;
            
            // Simple box blur implementation
            const radius = Math.floor(intensity / 2);
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    let r = 0, g = 0, b = 0, a = 0;
                    let count = 0;
                    
                    for (let dy = -radius; dy <= radius; dy++) {
                        for (let dx = -radius; dx <= radius; dx++) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                                const idx = (ny * width + nx) * 4;
                                r += data[idx];
                                g += data[idx + 1];
                                b += data[idx + 2];
                                a += data[idx + 3];
                                count++;
                            }
                        }
                    }
                    
                    const idx = (y * width + x) * 4;
                    outputData[idx] = r / count;
                    outputData[idx + 1] = g / count;
                    outputData[idx + 2] = b / count;
                    outputData[idx + 3] = a / count;
                }
            }
        }
        
        function applyEdgeDetection(input, output, intensity) {
            // Simple Sobel operator implementation
            const data = input.data;
            const outputData = output.data;
            const width = input.width;
            const height = input.height;
            
            // Convert to grayscale first
            const grayData = new Uint8ClampedArray(width * height);
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = (y * width + x) * 4;
                    grayData[y * width + x] = data[idx] * 0.3 + data[idx + 1] * 0.59 + data[idx + 2] * 0.11;
                }
            }
            
            // Apply Sobel operator
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const gx = 
                        -grayData[(y-1)*width + (x-1)] + grayData[(y-1)*width + (x+1)] +
                        -2 * grayData[y*width + (x-1)] + 2 * grayData[y*width + (x+1)] +
                        -grayData[(y+1)*width + (x-1)] + grayData[(y+1)*width + (x+1)];
                    
                    const gy = 
                        -grayData[(y-1)*width + (x-1)] - 2 * grayData[(y-1)*width + x] - grayData[(y-1)*width + (x+1)] +
                        grayData[(y+1)*width + (x-1)] + 2 * grayData[(y+1)*width + x] + grayData[(y+1)*width + (x+1)];
                    
                    const magnitude = Math.min(255, Math.sqrt(gx*gx + gy*gy) * intensity);
                    
                    const idx = (y * width + x) * 4;
                    outputData[idx] = magnitude;
                    outputData[idx + 1] = magnitude;
                    outputData[idx + 2] = magnitude;
                    outputData[idx + 3] = 255;
                }
            }
        }
        
        function applySharpen(input, output, intensity) {
            // Simple sharpen implementation using convolution
            const data = input.data;
            const outputData = output.data;
            const width = input.width;
            const height = input.height;
            
            const factor = intensity / 10;
            const kernel = [
                0, -1, 0,
                -1, 5 + factor, -1,
                0, -1, 0
            ];
            
            applyConvolution(data, outputData, width, height, kernel);
        }
        
        function applyInvert(input, output) {
            const data = input.data;
            const outputData = output.data;
            
            for (let i = 0; i < data.length; i += 4) {
                outputData[i] = 255 - data[i];
                outputData[i + 1] = 255 - data[i + 1];
                outputData[i + 2] = 255 - data[i + 2];
                outputData[i + 3] = data[i + 3];
            }
        }
        
        function applyEmboss(input, output, intensity) {
            // Emboss filter implementation
            const data = input.data;
            const outputData = output.data;
            const width = input.width;
            const height = input.height;
            
            const kernel = [
                -2, -1, 0,
                -1, 1, 1,
                0, 1, 2
            ];
            
            applyConvolution(data, outputData, width, height, kernel);
            
            // Adjust contrast based on intensity
            const factor = 1 + (intensity / 10);
            for (let i = 0; i < outputData.length; i += 4) {
                outputData[i] = Math.min(255, Math.max(0, (outputData[i] - 128) * factor + 128));
                outputData[i + 1] = Math.min(255, Math.max(0, (outputData[i + 1] - 128) * factor + 128));
                outputData[i + 2] = Math.min(255, Math.max(0, (outputData[i + 2] - 128) * factor + 128));
            }
        }
        
        function applyConvolution(input, output, width, height, kernel) {
            const side = Math.round(Math.sqrt(kernel.length));
            const half = Math.floor(side / 2);
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const r = [0, 0, 0];
                    
                    for (let ky = 0; ky < side; ky++) {
                        for (let kx = 0; kx < side; kx++) {
                            const cy = y + ky - half;
                            const cx = x + kx - half;
                            
                            if (cy >= 0 && cy < height && cx >= 0 && cx < width) {
                                const cidx = (cy * width + cx) * 4;
                                const kidx = ky * side + kx;
                                
                                r[0] += input[cidx] * kernel[kidx];
                                r[1] += input[cidx + 1] * kernel[kidx];
                                r[2] += input[cidx + 2] * kernel[kidx];
                            }
                        }
                    }
                    
                    const idx = (y * width + x) * 4;
                    output[idx] = Math.min(255, Math.max(0, r[0]));
                    output[idx + 1] = Math.min(255, Math.max(0, r[1]));
                    output[idx + 2] = Math.min(255, Math.max(0, r[2]));
                    output[idx + 3] = input[idx + 3];
                }
            }
        }
    </script>
</body>
</html>